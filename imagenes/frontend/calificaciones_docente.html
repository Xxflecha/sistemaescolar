<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calificaciones Docente</title>
  <style>
    /* Usa estilos similares a horario_docente.html */
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7fb; }
    .header { background: #1846b6; color: #fff; display: flex; align-items: center; padding: 0 30px; height: 70px; position: relative; }
    .header img { height: 48px; margin-right: 18px; }
    .header-title { font-size: 2em; font-family: 'Habibi', serif; flex: 1; }
    .menu-hamburguesa { width: 48px; height: 48px; display: flex; flex-direction: column; justify-content: center; cursor: pointer; margin-right: 18px; z-index: 1001; }
    .menu-hamburguesa span { display: block; height: 5px; width: 32px; background: #fff; margin: 5px 0; border-radius: 2px; transition: 0.2s; }
    .avatar { width: 80px; height: 80px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-left: 10px; cursor: pointer; border: 2px solid #fff; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }
    .menu-desplegable { display: none; position: absolute; top: 70px; left: 10px; background: #fff; color: #1846b6; border-radius: 12px; box-shadow: 0 4px 16px rgba(24,70,182,0.12); min-width: 180px; z-index: 2000; flex-direction: column; padding: 10px 0; }
    .menu-desplegable a { color: #1846b6; text-decoration: none; font-size: 1.1em; padding: 12px 30px; border-radius: 0 18px 18px 0; transition: background 0.2s, color 0.2s; margin-right: 10px; display: block; cursor: pointer; }
    .menu-desplegable a:hover { background: #e5e7eb; color: #0d2a6b; font-weight: bold; }
    .main-content { max-width: 900px; margin: 40px auto 0 auto; padding: 0 20px 40px 20px; }
    .calif-table { border-collapse: collapse; width: 100%; margin-top: 18px; background: #fff; box-shadow: 0 2px 8px rgba(24,70,182,0.04); border-radius: 8px; overflow: hidden; }
    .calif-table th, .calif-table td { border: 1px solid #bdbdbd; padding: 8px 10px; text-align: center; }
    .calif-table th { background: #bfa16c; color: #fff; font-weight: bold; }
    .calif-table tr:nth-child(even) { background: #f9fafb; }
    .calif-table tr:hover { background: #f3f4f6; }
    .error-message { color: #c00; margin-bottom: 10px; font-size: 1em; }
  </style>
</head>
<body>
  <div class="header">
    <div class="menu-hamburguesa" id="menuBtn">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <img src="public/tecnologico.png" alt="Logo TecNM">
    <span class="header-title">Ingenieria En Sistemas Computacionales</span>
    <div class="avatar" id="avatar">
      <img id="foto-perfil" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Foto de perfil">
    </div>
    <div class="menu-desplegable" id="menuDesplegable">
      <a onclick="irA('docentes.html')">Inicio</a>
      <a onclick="irA('horario_docente.html')">Horario</a>
      <a onclick="irA('calificaciones_docente.html')">Calificaciones</a>
      <a onclick="cerrarSesion()">Cerrar sesión</a>
    </div>
  </div>
  <div class="main-content">
    <h2>Calificaciones - Materias que impartes</h2>
    <table class="calif-table">
      <thead>
        <tr>
          <th>Clave</th>
          <th>Materia</th>
          <th>Grupo</th>
          <th>Alumnos</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="calif-body"></tbody>
    </table>
    <div class="error-message" id="errorMsgCalif" style="display:none;"></div>
  </div>
  <script>
    // ...menú hamburguesa igual que en alumnos...
    function irA(pagina) { window.location.href = pagina; }
    function cerrarSesion() { localStorage.removeItem('docente'); window.location.href = 'indexSP.html'; }
    let docente = null;
    document.addEventListener('DOMContentLoaded', function() {
      docente = JSON.parse(localStorage.getItem('docente'));
      if (!docente) { window.location.href = 'indexSP.html'; return; }
      if (docente.foto_perfil) document.getElementById('foto-perfil').src = docente.foto_perfil;
      cargarCalificaciones();
    });
    async function cargarCalificaciones() {
      const tbody = document.getElementById('calif-body');
      tbody.innerHTML = '';
      document.getElementById('errorMsgCalif').style.display = 'none';
      try {
        const res = await fetch(`http://localhost:4000/api/materias-docente/${docente.id}`);
        if (!res.ok) throw new Error('No se pudo cargar las materias');
        const materiasDocente = await res.json();
        if (!Array.isArray(materiasDocente) || materiasDocente.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5">No tienes materias asignadas en el periodo actual.</td></tr>';
          return;
        }
        materiasDocente.forEach(m => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${m.clave_materia || ''}</td>
            <td>${m.nombre_materia || ''}</td>
            <td>${m.grupo || ''}</td>
            <td><button onclick="verAlumnos(${m.materia_id},'${m.grupo}')">Ver alumnos</button></td>
            <td></td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        document.getElementById('errorMsgCalif').textContent = 'Error al cargar materias';
        document.getElementById('errorMsgCalif').style.display = 'block';
      }
    }
    function verAlumnos(materia_id, grupo) {
      // Aquí puedes abrir un modal o redirigir a una pantalla para editar calificaciones de los alumnos de esa materia y grupo
      alert('Funcionalidad de edición de calificaciones no implementada en este ejemplo.');
    }
  </script>
</body>
</html>
