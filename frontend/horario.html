<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Horario - Alumno</title>
  <style>
    body { margin: 0; font-family: 'Segoe UI', Arial, sans-serif; background: #f4f7fb; }
    .header { background: #1846b6; color: #fff; display: flex; align-items: center; padding: 0 30px; height: 70px; position: relative; }
    .header img { height: 48px; margin-right: 18px; }
    .header-title { font-size: 2em; font-family: 'Habibi', serif; flex: 1; }
    /* HAZ VISIBLE EL MENÚ HAMBURGUESA */
    .menu-hamburguesa {
      width: 48px;
      height: 48px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      cursor: pointer;
      margin-right: 18px;
      z-index: 1001;
    }
    .menu-hamburguesa span {
      display: block;
      height: 5px;
      width: 32px;
      background: #fff;
      margin: 5px 0;
      border-radius: 2px;
      transition: 0.2s;
    }
    .avatar { width: 80px; height: 80px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; overflow: hidden; margin-left: 10px; cursor: pointer; border: 2px solid #fff; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }
    .menu-desplegable {
      display: none;
      position: absolute;
      top: 70px;
      left: 10px;
      background: #fff;
      color: #1846b6;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(24,70,182,0.12);
      min-width: 180px;
      z-index: 2000;
      flex-direction: column;
      padding: 10px 0;
    }
    .menu-desplegable a {
      color: #1846b6;
      text-decoration: none;
      font-size: 1.1em;
      padding: 12px 30px;
      border-radius: 0 18px 18px 0;
      transition: background 0.2s, color 0.2s;
      margin-right: 10px;
      display: block;
      cursor: pointer;
    }
    .menu-desplegable a:hover {
      background: #e5e7eb;
      color: #0d2a6b;
      font-weight: bold;
    }
    .main-content { max-width: 900px; margin: 40px auto 0 auto; padding: 0 20px 40px 20px; }
    .info-card { background: #fff; border-radius: 12px; box-shadow: 0 2px 8px rgba(24,70,182,0.08); padding: 30px; margin-bottom: 30px; }
    .horario-table { border-collapse: collapse; width: 100%; margin-top: 18px; background: #fff; box-shadow: 0 2px 8px rgba(24,70,182,0.04); border-radius: 8px; overflow: hidden; }
    .horario-table th, .horario-table td { border: 1px solid #bdbdbd; padding: 8px 10px; text-align: center; }
    .horario-table th { background: #bfa16c; color: #fff; font-weight: bold; }
    .horario-table tr:nth-child(even) { background: #f9fafb; }
    .horario-table tr:hover { background: #f3f4f6; }
    .error-message { color: #c00; margin-bottom: 10px; font-size: 1em; }
  </style>
</head>
<body>
  <div class="header">
    <div class="menu-hamburguesa" id="menuBtn">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <img src="public/tecnologico.png" alt="Logo TecNM">
    <span class="header-title">Ingenieria En Sistemas Computacionales</span>
    <div class="avatar" id="avatar">
      <img id="foto-perfil" src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="Foto de perfil">
    </div>
    <div class="menu-desplegable" id="menuDesplegable">
      <a onclick="irA('alumnos.html')">Inicio</a>
      <a onclick="irA('calificaciones.html')">Calificaciones</a>
      <a onclick="irA('horario.html')">Horario</a>
      <a onclick="irA('kardex.html')">Kardex</a>
      <a onclick="cerrarSesion()">Cerrar sesión</a>
    </div>
  </div>
  <div class="main-content">
    <div class="info-card" id="alumno-info"></div>
    <div class="info-card">
      <h2>Horario del periodo actual</h2>
      <table class="horario-table">
        <thead>
          <tr>
            <th>Clave</th>
            <th>Materia</th>
            <th>Créditos</th>
            <th>Grupo</th>
            <th>Docente</th>
            <th>Lunes</th>
            <th>Martes</th>
            <th>Miércoles</th>
            <th>Jueves</th>
            <th>Viernes</th>
            <th>Sábado</th>
            <th>Domingo</th>
          </tr>
        </thead>
        <tbody id="horario-body"></tbody>
      </table>
      <div class="error-message" id="errorMsg" style="display:none;"></div>
    </div>
  </div>
  <script>
    // Menú hamburguesa
    document.getElementById('menuBtn').onclick = function(e) {
      const menu = document.getElementById('menuDesplegable');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
      menu.style.flexDirection = 'column';
      e.stopPropagation();
    };
    document.body.onclick = function() {
      document.getElementById('menuDesplegable').style.display = 'none';
    };
    document.getElementById('menuDesplegable').onclick = function(e) {
      e.stopPropagation();
    };
    function irA(pagina) {
      window.location.href = pagina;
    }
    function cerrarSesion() {
      localStorage.removeItem('alumno');
      window.location.href = 'indexSP.html';
    }

    let alumno = null;
    document.addEventListener('DOMContentLoaded', function() {
      alumno = JSON.parse(localStorage.getItem('alumno'));
      if (!alumno) {
        window.location.href = 'indexSP.html';
        return;
      }
      document.getElementById('alumno-info').innerHTML = `
        <b>${alumno.nombre || ''} ${alumno.apellido_paterno || ''} ${alumno.apellido_materno || ''}</b><br>
        No. Control: ${alumno.no_control || ''} &nbsp; | &nbsp; Carrera: ${alumno.carrera || ''} &nbsp; | &nbsp; Semestre: ${alumno.semestre || ''}<br>
        Periodo actual: <b>${alumno.periodo_actual || 'N/D'}</b><br>
        Correo: ${alumno.correo_personal || ''} &nbsp; | &nbsp; Teléfono: ${alumno.telefono || ''}
      `;
      cargarHorario();
    });

    async function cargarHorario() {
      const tbody = document.getElementById('horario-body');
      tbody.innerHTML = '';
      document.getElementById('errorMsg').style.display = 'none';
      try {
        const res = await fetch(`http://localhost:4000/api/horario/${alumno.id}`);
        if (!res.ok) throw new Error('No se pudo cargar el horario');
        const materias = await res.json();
        if (!Array.isArray(materias) || materias.length === 0) {
          tbody.innerHTML = '<tr><td colspan="12">No hay materias registradas para tu periodo actual.</td></tr>';
          return;
        }
        materias.forEach(m => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${m.clave_materia || ''}</td>
            <td>${m.nombre_materia || ''}</td>
            <td>${m.creditos || ''}</td>
            <td>${m.grupo || ''}</td>
            <td>${m.docente_nombre || ''}</td>
            <td>${m.lunes || ''}</td>
            <td>${m.martes || ''}</td>
            <td>${m.miercoles || ''}</td>
            <td>${m.jueves || ''}</td>
            <td>${m.viernes || ''}</td>
            <td>${m.sabado || ''}</td>
            <td>${m.domingo || ''}</td>
          `;
          tbody.appendChild(tr);
        });
      } catch (err) {
        document.getElementById('errorMsg').textContent = 'Error al cargar el horario';
        document.getElementById('errorMsg').style.display = 'block';
      }
    }
  </script>
</body>
</html>
